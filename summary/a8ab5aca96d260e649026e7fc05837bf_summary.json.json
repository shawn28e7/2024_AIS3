{
    "data": {
        "files_opened": [
            "C:\\WINDOWS\\system32\\winime32.dll",
            "C:\\WINDOWS\\system32\\ws2_32.dll",
            "C:\\WINDOWS\\system32\\ws2help.dll",
            "C:\\WINDOWS\\system32\\psapi.dll",
            "C:\\WINDOWS\\system32\\imm32.dll",
            "C:\\WINDOWS\\system32\\lpk.dll",
            "C:\\WINDOWS\\system32\\usp10.dll",
            "C:\\WINDOWS\\system32\\wininet.dll",
            "C:\\WINDOWS\\WinSxS\\x86_Microsoft.Windows.Common-Controls_6595b64144ccf1df_6.0.2600.5512_x-ww_35d4ce83\\comctl32.dll",
            "C:\\WINDOWS\\WindowsShell.Manifest",
            "C:\\WINDOWS\\system32\\shell32.dll",
            "C:\\WINDOWS\\system32\\comctl32.dll",
            "C:\\WINDOWS\\system32\\msvcr100.dll",
            "C:\\Documents and Settings\\Administrator\\Local Settings\\Temp\\EB93A6\\996E.exe",
            "C:\\WINDOWS\\system32\\rsaenh.dll",
            "C:\\1ea9852c342041cbe76c15e76b9cbb2d5929cdd6649df0fdff6c16d065b16c56",
            "c:\\autoexec.bat",
            "\\\\.\\PIPE\\ROUTER",
            "\\\\.\\Ip",
            "\\\\.\\PIPE\\lsarpc",
            "C:\\WINDOWS\\System32\\svchost.exe"
        ],
        "processes_terminated": [
            "C:\\Documents and Settings\\Administrator\\Local Settings\\Temp\\EB93A6\\996E.exe",
            "svchost.exe"
        ],
        "processes_created": [
            "C:\\WINDOWS\\System32\\svchost.exe\" -c \"C:\\Documents and Settings\\All Users\\Application Data\\FtqBnjJnmF\\cfg\"\""
        ],
        "ip_traffic": [
            {
                "destination_ip": "193.32.161.69",
                "destination_port": 80,
                "transport_layer_protocol": "TCP"
            }
        ],
        "services_opened": [
            "RASMAN"
        ],
        "registry_keys_set": [
            {
                "key": "\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet002\\Control\\Session Manager\\KnownDLLs\\ntdll",
                "value": "ntdll.dll\u0000"
            }
        ],
        "http_conversations": [
            {
                "url": "http://193.32.161.69/upd.txt",
                "request_method": "GET",
                "request_headers": {
                    "User-Agent": "WinInetGet/0.1"
                }
            }
        ],
        "mutexes_opened": [
            "718925f232b7f837a482",
            "RasPbFile"
        ],
        "processes_tree": [
            {
                "process_id": "1488",
                "name": "****.exe"
            }
        ],
        "modules_loaded": [
            "kernel32.dll",
            "advapi32.dll",
            "comctl32.dll",
            "KERNEL32",
            "KERNEL32.dll",
            "USER32.dll",
            "ADVAPI32.dll",
            "imm32.dll",
            "ole32.dll",
            "ntdll.dll",
            "C:\\WINDOWS\\system32\\rsaenh.dll",
            "wininet.dll",
            "user32.dll",
            "shell32.dll",
            "msvcr100.dll",
            "rsaenh.dll",
            "secur32.dll",
            "wsock32",
            "ws2_32",
            "rasapi32.dll",
            "rtutils.dll",
            "rpcrt4.dll",
            "rasman.dll",
            "c:\\windows\\system32\\msv1_0.dll",
            "sensapi.dll",
            "userenv.dll",
            "netapi32.dll",
            "c:\\windows\\system32\\mswsock.dll",
            "hnetcfg.dll",
            "c:\\windows\\system32\\wshtcpip.dll",
            "version.dll"
        ],
        "signature_matches": [
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "change memory protection",
                "authors": [
                    "@mr-tz"
                ],
                "rule_src": "rule:\n  meta:\n    name: change memory protection\n    authors:\n      - \"@mr-tz\"\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: call\n    mbc:\n      - Memory::Change Memory Protection [C0008]\n    examples:\n      - Practical Malware Analysis Lab 11-02.dll_:0x10001203\n  features:\n    - or:\n      - api: kernel32.VirtualProtect\n      - api: kernel32.VirtualProtectEx\n      - api: NtProtectVirtualMemory\n      - api: ZwProtectVirtualMemory\n      - and:\n        - match: link function at runtime on Windows\n        - or:\n          - string: \"VirtualProtect\"\n          - string: \"VirtualProtectEx\"\n          - string: \"NtProtectVirtualMemory\"\n          - string: \"ZwProtectVirtualMemory\"\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "allocate or change RWX memory",
                "description": "host-interaction/process/inject",
                "authors": [
                    "@mr-tz"
                ],
                "rule_src": "rule:\n  meta:\n    name: allocate or change RWX memory\n    namespace: host-interaction/process/inject\n    authors:\n      - \"@mr-tz\"\n    scopes:\n      static: basic block\n      dynamic: thread\n    mbc:\n      - Memory::Allocate Memory [C0007]\n    examples:\n      - Practical Malware Analysis Lab 03-03.exe_:0x4010EA\n      # ntdll\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140001ABA\n  features:\n    - and:\n      - or:\n        - match: allocate memory\n        - match: change memory protection\n      - or:\n        - number: 0x40 = PAGE_EXECUTE_READWRITE\n        # lea     r9d, [rcx+40h]  ; flProtect\n        # call    cs:VirtualAlloc\n        - instruction:\n          - mnemonic: lea\n          - offset: 0x40 = PAGE_EXECUTE_READWRITE\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "contain obfuscated stackstrings",
                "description": "anti-analysis/obfuscation/string/stackstring",
                "authors": [
                    "moritz.raabe@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: contain obfuscated stackstrings\n    namespace: anti-analysis/obfuscation/string/stackstring\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: basic block\n      dynamic: unsupported\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]\n    mbc:\n      - Anti-Static Analysis::Executable Code Obfuscation::Argument Obfuscation [B0032.020]\n      - Anti-Static Analysis::Executable Code Obfuscation::Stack Strings [B0032.017]\n    examples:\n      - Practical Malware Analysis Lab 16-03.exe_:0x4013D0\n  features:\n    - characteristic: stack string\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "delay execution",
                "authors": [
                    "michael.hunhoff@mandiant.com",
                    "@ramen0x3f"
                ],
                "rule_src": "rule:\n  meta:\n    name: delay execution\n    authors:\n      - michael.hunhoff@mandiant.com\n      - \"@ramen0x3f\"\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: call\n    mbc:\n      - Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]\n    references:\n      - https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp\n    examples:\n      - al-khaser_x86.exe_:0x449770\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6\n  features:\n    - or:\n      - and:\n        - os: windows\n        - or:\n          - api: kernel32.Sleep\n          - api: kernel32.SleepEx\n          - api: kernel32.WaitForSingleObject\n          - api: kernel32.SignalObjectAndWait\n          - api: kernel32.WaitForSingleObjectEx\n          - api: kernel32.WaitForMultipleObjects\n          - api: kernel32.WaitForMultipleObjectsEx\n          - api: kernel32.RegisterWaitForSingleObject\n          - api: WaitOnAddress\n          - api: user32.MsgWaitForMultipleObjects\n          - api: user32.MsgWaitForMultipleObjectsEx\n          - api: NtDelayExecution\n          - api: KeWaitForSingleObject\n          - api: KeDelayExecutionThread\n      - and:\n        - os: linux\n        - or:\n          - api: sleep\n          - api: usleep\n",
                "refs": [
                    {
                        "ref": "https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions"
                    },
                    {
                        "ref": "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp"
                    }
                ]
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "create or open file",
                "authors": [
                    "michael.hunhoff@mandiant.com",
                    "joakim@intezer.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: create or open file\n    authors:\n      - michael.hunhoff@mandiant.com\n      - joakim@intezer.com\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: call\n    mbc:\n      - File System::Create File [C0016]\n    examples:\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x401D7E\n  features:\n    - or:\n      - api: CreateFile\n      - api: CreateFileEx\n      - api: IoCreateFile\n      - api: IoCreateFileEx\n      - api: ZwOpenFile\n      - api: ZwCreateFile\n      - api: NtOpenFile\n      - api: NtCreateFile\n      - api: LZCreateFile\n      - api: LZOpenFile\n      - api: fopen\n      - api: fopen64\n      - api: fdopen\n      - api: freopen\n      - api: open\n      - api: openat\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "contain loop",
                "authors": [
                    "moritz.raabe@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: contain loop\n    authors:\n      - moritz.raabe@mandiant.com\n    lib: true\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic features\n    examples:\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\n  features:\n    - or:\n      - characteristic: loop\n      - characteristic: tight loop\n      - characteristic: recursive call\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "query environment variable",
                "description": "host-interaction/environment-variable",
                "authors": [
                    "michael.hunhoff@mandiant.com",
                    "@_re_fox"
                ],
                "rule_src": "rule:\n  meta:\n    name: query environment variable\n    namespace: host-interaction/environment-variable\n    authors:\n      - michael.hunhoff@mandiant.com\n      - \"@_re_fox\"\n    scopes:\n      static: function\n      dynamic: call\n    att&ck:\n      - Discovery::System Information Discovery [T1082]\n    mbc:\n      - Discovery::System Information Discovery [E1082]\n    examples:\n      - Practical Malware Analysis Lab 14-02.exe_:0x401880\n      - 0761142efbda6c4b1e801223de723578:0x65483490\n  features:\n    - or:\n      - api: kernel32.GetEnvironmentVariable\n      - api: kernel32.GetEnvironmentStrings\n      - api: kernel32.ExpandEnvironmentStrings\n      - api: msvcr90.getenv\n      - api: msvcrt.getenv\n      - api: System.Environment::GetEnvironmentVariable\n      - api: System.Environment::GetEnvironmentVariables\n      - api: System.Environment::ExpandEnvironmentVariables\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "move file",
                "description": "host-interaction/file-system/move",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "michael.hunhoff@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: move file\n    namespace: host-interaction/file-system/move\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    mbc:\n      - File System::Move File [C0063]\n    examples:\n      - Practical Malware Analysis Lab 01-04.exe_:0x401350\n  features:\n    - or:\n      - api: kernel32.MoveFile\n      - api: kernel32.MoveFileEx\n      - api: MoveFileWithProgress\n      - api: MoveFileTransacted\n      - api: rename\n      - api: _wrename\n      - api: System.IO.FileInfo::MoveTo\n      - api: System.IO.File::Move\n      - basic block:\n        - and:\n          - number: 1 = FO_MOVE\n          - or:\n            - api: kernel32.SHFileOperation\n      - call:\n        - and:\n          - number: 1 = FO_MOVE\n          - api: kernel32.SHFileOperation\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "get OS version",
                "authors": [
                    "@mr-tz"
                ],
                "rule_src": "rule:\n  meta:\n    name: get OS version\n    authors:\n      - \"@mr-tz\"\n    lib: true\n    scopes:\n      static: function\n      dynamic: call\n    examples:\n      - 493167E85E45363D09495D0841C30648:0x401000\n      - 5f66b82558ca92e54e77f216ef4c066c:0x44580A\n  features:\n    - or:\n      - api: RtlGetVersion\n      - api: ntoskrnl.PsGetVersion\n      - api: GetVersion\n      - api: GetVersionEx\n      - api: VerifyVersionInfo\n      - api: VerSetConditionMask\n      - api: RtlGetNtVersionNumbers\n      - api: GetProductInfo\n      - and:\n        - match: PEB access\n        - or:\n          - and:\n            - arch: i386\n            - or:\n              - offset: 0xA4 = PEB->OSMajorVersion\n              - offset: 0xA8 = PEB->OSMinorVersion\n              - offset: 0xAC = PEB->OSBuildNumber\n          - and:\n            - arch: amd64\n            - or:\n              - offset: 0x118 = PEB->OSMajorVersion\n              - offset: 0x11C = PEB->OSMinorVersion\n              - offset: 0x120 = PEB->OSBuildNumber\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "get UEFI variable",
                "description": "host-interaction/bootloader",
                "authors": [
                    "jakub.jozwiak@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: get UEFI variable\n    namespace: host-interaction/bootloader\n    authors:\n      - jakub.jozwiak@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n    att&ck:\n      - Persistence::Pre-OS Boot::System Firmware [T1542.001]\n    references:\n      - https://learn.microsoft.com/en-us/windows/win32/sysinfo/access-uefi-firmware-variables-from-a-universal-windows-app\n    examples:\n      - b761e060c7114448d6a5fe276d4ca882c4bd702c12c4d73f6ad79b8dfac33448:0x14000138F\n  features:\n    - or:\n      - api: ntdll.NtEnumerateSystemEnvironmentValuesEx\n      - api: ntdll.NtQuerySystemEnvironmentValueEx\n      - api: ntdll.NtQuerySystemEnvironmentValue\n      - api: kernel32.GetFirmwareEnvironmentVariable\n      - api: kernel32.GetFirmwareEnvironmentVariableEx\n      - api: ntoskrnl.ExGetFirmwareEnvironmentVariable\n",
                "refs": [
                    {
                        "ref": "https://learn.microsoft.com/en-us/windows/win32/sysinfo/access-uefi-firmware-variables-from-a-universal-windows-app"
                    }
                ]
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "get common file path",
                "description": "host-interaction/file-system",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "michael.hunhoff@mandiant.com",
                    "anushka.virgaonkar@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: get common file path\n    namespace: host-interaction/file-system\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n    att&ck:\n      - Discovery::File and Directory Discovery [T1083]\n    mbc:\n      - Discovery::File and Directory Discovery [E1083]\n    examples:\n      - Practical Malware Analysis Lab 03-02.dll_:0x10003415\n      - 972B219F18379907A045431303F4DA7D:0x404887\n  features:\n    - or:\n      - api: kernel32.GetTempPath\n      - api: kernel32.GetTempFileName\n      - api: kernel32.GetSystemDirectory\n      - api: kernel32.GetWindowsDirectory\n      - api: kernel32.GetSystemWow64Directory\n      - api: GetAllUsersProfileDirectory\n      - api: GetAppContainerFolderPath\n      - api: GetCurrentDirectory\n      - api: GetDefaultUserProfileDirectory\n      - api: GetProfilesDirectory\n      - api: GetUserProfileDirectory\n      - api: SHGetFolderPathAndSubDir\n      - api: shell32.SHGetFolderPath\n      - api: shell32.SHGetFolderLocation\n      - api: shell32.SHGetKnownFolderPath\n      - api: shell32.SHGetSpecialFolderPath\n      - api: shell32.SHGetSpecialFolderLocation\n      - api: System.IO.Directory::GetCurrentDirectory\n      - api: System.Environment::GetFolderPath\n      - property/read: System.Environment::SystemDirectory\n      - property/read: System.Environment::CurrentDirectory\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "get disk information",
                "description": "host-interaction/hardware/storage",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "anushka.virgaonkar@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: get disk information\n    namespace: host-interaction/hardware/storage\n    authors:\n      - moritz.raabe@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n    att&ck:\n      - Discovery::System Information Discovery [T1082]\n    mbc:\n      - Discovery::System Information Discovery [E1082]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4052A0\n      - 972B219F18379907A045431303F4DA7D:0x41064E\n  features:\n    - or:\n      - api: kernel32.GetDriveType\n      - api: kernel32.GetLogicalDrives\n      - api: kernel32.GetVolumeInformation\n      - api: kernel32.GetVolumeNameForVolumeMountPoint\n      - api: kernel32.GetVolumePathNamesForVolumeName\n      - api: kernel32.GetLogicalDriveStrings\n      - api: kernel32.QueryDosDevice\n      - property/read: System.IO.DriveInfo::VolumeLabel\n      - property/read: System.IO.DriveInfo::DriveType\n      - property/read: System.IO.DriveInfo::DriveFormat\n      - property/read: System.IO.DriveInfo::Name\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "create mailslot",
                "description": "communication/mailslot",
                "authors": [
                    "william.ballenthin@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: create mailslot\n    namespace: communication/mailslot\n    authors:\n      - william.ballenthin@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    mbc:\n      - Communication::Interprocess Communication [C0003]\n    references:\n      - https://learn.microsoft.com/en-us/windows/win32/ipc/mailslots\n    examples:\n      - af13e7583ed1b27c4ae219e344a37e2b:0x40151D\n  features:\n    - and:\n      - api: kernel32.CreateMailslot\n      - optional:\n        - api: kernel32.GetMailslotInfo\n        - api: kernel32.SetMailslotInfo\n",
                "refs": [
                    {
                        "ref": "https://learn.microsoft.com/en-us/windows/win32/ipc/mailslots"
                    }
                ]
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "get system information on Windows",
                "description": "host-interaction/os/info",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "joakim@intezer.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: get system information on Windows\n    namespace: host-interaction/os/info\n    authors:\n      - moritz.raabe@mandiant.com\n      - joakim@intezer.com\n    scopes:\n      static: function\n      dynamic: thread\n    att&ck:\n      - Discovery::System Information Discovery [T1082]\n    examples:\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140002280\n  features:\n    - and:\n      - os: windows\n      - or:\n        - api: kernel32.GetSystemInfo\n        - api: kernel32.GetNativeSystemInfo\n        - api: NtQuerySystemInformation\n        - api: NtQuerySystemInformationEx\n        - api: ntdll.RtlGetNativeSystemInformation\n        - api: ZwQuerySystemInformation\n        - api: ZwQuerySystemInformationEx\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "terminate process",
                "description": "host-interaction/process/terminate",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "michael.hunhoff@mandiant.com",
                    "anushka.virgaonkar@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: terminate process\n    namespace: host-interaction/process/terminate\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    mbc:\n      - Process::Terminate Process [C0018]\n    examples:\n      - C91887D861D9BD4A5872249B641BC9F9:0x401A77\n      - 9B7CCAA2AE6A5B96E3110EBCBC4311F6:0x10010307\n  features:\n    - or:\n      - api: System.Diagnostics.Process::Kill\n      - api: System.Diagnostics.Process::WaitForExit\n      - api: System.Diagnostics.Process::WaitForExitAsync\n      - api: System.Environment::Exit\n      - api: System.Windows.Forms.Application::Exit\n      - api: exit\n      - api: Exit\n      - and:\n        - optional:\n          - match: open process\n        - or:\n          - api: kernel32.TerminateProcess\n          - api: ntdll.NtTerminateProcess\n          - api: kernel32.ExitProcess\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "get thread local storage value",
                "description": "host-interaction/process",
                "authors": [
                    "michael.hunhoff@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: get thread local storage value\n    namespace: host-interaction/process\n    authors:\n      - michael.hunhoff@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n  features:\n    - and:\n      - api: kernel32.TlsGetValue\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "print debug messages",
                "description": "host-interaction/log/debug/write-event",
                "authors": [
                    "michael.hunhoff@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: print debug messages\n    namespace: host-interaction/log/debug/write-event\n    authors:\n      - michael.hunhoff@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n    examples:\n      - 493167E85E45363D09495D0841C30648:0x401000\n  features:\n    - or:\n      - api: DbgPrint\n      - api: kernel32.OutputDebugString\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "link function at runtime on Windows",
                "description": "linking/runtime-linking",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "michael.hunhoff@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: link function at runtime on Windows\n    namespace: linking/runtime-linking\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic features\n    att&ck:\n      - Execution::Shared Modules [T1129]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x404130\n      - Practical Malware Analysis Lab 01-04.exe_:0x401350\n  features:\n    - and:\n      - os: windows\n      - or:\n        - api: kernel32.GetProcAddress\n        - api: ntdll.LdrGetProcedureAddress\n      - optional:\n        - characteristic: indirect call\n        - api: kernel32.LoadLibrary\n        - api: kernel32.GetModuleHandle\n        - api: kernel32.GetModuleHandleEx\n        - api: ntdll.LdrLoadDll\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "link many functions at runtime",
                "description": "linking/runtime-linking",
                "authors": [
                    "moritz.raabe@mandiant.com",
                    "joakim@intezer.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: link many functions at runtime\n    namespace: linking/runtime-linking\n    authors:\n      - moritz.raabe@mandiant.com\n      - joakim@intezer.com\n    scopes:\n      static: function\n      dynamic: thread\n    att&ck:\n      - Execution::Shared Modules [T1129]\n    examples:\n      - b7b5e1253710d8927cbe07d52d2d2e10:0x401000\n  features:\n    - or:\n      - and:\n        - os: windows\n        - match: link function at runtime on Windows\n        - or:\n          - count(api(kernel32.GetProcAddress)): 5 or more\n          - count(api(ntdll.LdrGetProcedureAddress)): 5 or more\n      - and:\n        - os: linux\n        - match: link function at runtime on Linux\n        - or:\n          - count(api(dlsym)): 5 or more\n          - count(api(dlvsym)): 5 or more\n"
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "linked against CPP regex library",
                "description": "linking/static/cppregex",
                "authors": [
                    "william.ballenthin@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: linked against CPP regex library\n    namespace: linking/static/cppregex\n    authors:\n      - william.ballenthin@mandiant.com\n    scopes:\n      static: file\n      dynamic: file\n    references:\n      - http://www.cplusplus.com/reference/regex/regex_error/\n  features:\n    - or:\n      - string: \"regex_error(error_syntax)\"\n        description: C++ STL regex library\n      - string: \"regex_error(error_collate): The expression contained an invalid collating element name.\"\n",
                "refs": [
                    {
                        "ref": "http://www.cplusplus.com/reference/regex/regex_error/"
                    }
                ]
            },
            {
                "format": "SIG_FORMAT_CAPA",
                "name": "contains PDB path",
                "description": "executable/pe/pdb",
                "authors": [
                    "moritz.raabe@mandiant.com"
                ],
                "rule_src": "rule:\n  meta:\n    name: contains PDB path\n    namespace: executable/pe/pdb\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: file\n      dynamic: file\n    examples:\n      - 464EF2CA59782CE697BC329713698CCC  # level32.exe\n  features:\n    - string: /:\\\\.*\\.pdb/\n"
            }
        ],
        "registry_keys_opened": [
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\996E.exe",
            "\\Registry\\MACHINE\\System\\CurrentControlSet\\Control\\SafeBoot\\Option",
            "\\Registry\\Machine\\Software\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers",
            "\\REGISTRY\\MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\TransparentEnabled",
            "\\REGISTRY\\USER\\S-1-5-21-1482476501-1645522239-1417001333-500\\Software\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\MSASN1.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\CRYPT32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\WININET.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\comctl32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\ntdll.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\KERNEL32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\GDI32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\USER32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Secur32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\RPCRT4.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\ADVAPI32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\msvcrt.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\WS2HELP.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\WS2_32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\SHLWAPI.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\PSAPI.DLL",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\ole32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\OLEAUT32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\winime32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\IMM32.DLL",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\USP10.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\LPK.DLL",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\SHELL32.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\msvcr100.dll",
            "\\Registry\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\rsaenh.dll",
            "\\REGISTRY\\MACHINE\\Software\\Policies\\Microsoft\\Cryptography"
        ],
        "mitre_attack_techniques": [
            {
                "id": "T1027.005",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "contain obfuscated stackstrings",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "contain obfuscated stackstrings"
                    }
                ]
            },
            {
                "id": "T1082",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "query environment variable",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "query environment variable"
                    }
                ]
            },
            {
                "id": "T1542.001",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "get UEFI variable",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "get UEFI variable"
                    }
                ]
            },
            {
                "id": "T1083",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "get common file path",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "get common file path"
                    }
                ]
            },
            {
                "id": "T1082",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "get disk information",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "get disk information"
                    }
                ]
            },
            {
                "id": "T1082",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "get system information on Windows",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "get system information on Windows"
                    }
                ]
            },
            {
                "id": "T1129",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "link function at runtime on Windows",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "link function at runtime on Windows"
                    }
                ]
            },
            {
                "id": "T1129",
                "severity": "IMPACT_SEVERITY_INFO",
                "signature_description": "link many functions at runtime",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "link many functions at runtime"
                    }
                ]
            }
        ],
        "mbc": [
            {
                "id": "C0008",
                "objective": "Memory",
                "behavior": "Change Memory Protection",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "change memory protection"
                    }
                ]
            },
            {
                "id": "C0007",
                "objective": "Memory",
                "behavior": "Allocate Memory",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "allocate or change RWX memory"
                    }
                ]
            },
            {
                "id": "B0032.020",
                "objective": "Anti-Static Analysis",
                "behavior": "Executable Code Obfuscation",
                "method": "Argument Obfuscation",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "contain obfuscated stackstrings"
                    }
                ]
            },
            {
                "id": "B0032.017",
                "objective": "Anti-Static Analysis",
                "behavior": "Executable Code Obfuscation",
                "method": "Stack Strings",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "contain obfuscated stackstrings"
                    }
                ]
            },
            {
                "id": "B0003.003",
                "objective": "Anti-Behavioral Analysis",
                "behavior": "Dynamic Analysis Evasion",
                "method": "Delayed Execution",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "delay execution"
                    }
                ]
            },
            {
                "id": "C0016",
                "objective": "File System",
                "behavior": "Create File",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "create or open file"
                    }
                ]
            },
            {
                "id": "E1082",
                "objective": "Discovery",
                "behavior": "System Information Discovery",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "query environment variable"
                    }
                ]
            },
            {
                "id": "C0063",
                "objective": "File System",
                "behavior": "Move File",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "move file"
                    }
                ]
            },
            {
                "id": "E1083",
                "objective": "Discovery",
                "behavior": "File and Directory Discovery",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "get common file path"
                    }
                ]
            },
            {
                "id": "E1082",
                "objective": "Discovery",
                "behavior": "System Information Discovery",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "get disk information"
                    }
                ]
            },
            {
                "id": "C0003",
                "objective": "Communication",
                "behavior": "Interprocess Communication",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "create mailslot"
                    }
                ]
            },
            {
                "id": "C0018",
                "objective": "Process",
                "behavior": "Terminate Process",
                "refs": [
                    {
                        "ref": "#signature_matches",
                        "value": "terminate process"
                    }
                ]
            }
        ],
        "mutexes_created": [
            "718925f232b7f837a482",
            "RasPbFile",
            "ShimCacheMutex"
        ],
        "attack_techniques": {
            "T1027.005": [
                {
                    "severity": "INFO",
                    "description": "contain obfuscated stackstrings"
                }
            ],
            "T1082": [
                {
                    "severity": "INFO",
                    "description": "query environment variable"
                },
                {
                    "severity": "INFO",
                    "description": "get disk information"
                },
                {
                    "severity": "INFO",
                    "description": "get system information on Windows"
                }
            ],
            "T1542.001": [
                {
                    "severity": "INFO",
                    "description": "get UEFI variable"
                }
            ],
            "T1083": [
                {
                    "severity": "INFO",
                    "description": "get common file path"
                }
            ],
            "T1129": [
                {
                    "severity": "INFO",
                    "description": "link function at runtime on Windows"
                },
                {
                    "severity": "INFO",
                    "description": "link many functions at runtime"
                }
            ]
        }
    }
}